<?xml version="1.0"?>
<!--
  XMLToolGen configuration file for ObDoc documentor
  Copyright (c) 2004 xMill Consulting Limited
-->

<xt:tool xmlns:xt="obtools.com/ns/tools">

  <!-- Setup of script processing for rest of file -->
  <xt:script language="C++">
    <!-- Tags to support C++ in XML - $ isn't significant to either -->
    <xt:tags>
      <xt:start-code>$(</xt:start-code>
      <xt:end-code>)$</xt:end-code>
      <xt:start-expr>$=</xt:start-expr>
      <xt:end-expr>=$</xt:end-expr>
    </xt:tags>
  </xt:script>

  <!-- Helper code -->
  <xt:code>
    // Make a string safe for HTML
    string htmlise(string s)
    {
      // Remember that the XML parser has a go at this first
      s = ObTools::Text::subst(s, "&amp;", "&amp;amp;");
      s = ObTools::Text::subst(s, "&lt;", "&amp;lt;");
      return s;
    }
  </xt:code>

  <!-- Macro define for description text at all levels -->
  <xt:define name="Desc" element="desc">
    <DIV CLASS="desc">
      <xt:template element="p"><P>$= *p =$</P></xt:template>
    </DIV>
  </xt:define>

  <!-- Macro define for file HEAD title -->
  <xt:define name="Title_HEAD" element="title">
    <xt:arg name="prefix" default=""/>
    <xt:arg name="dir" default=""/>
    <HEAD>
    <LINK REL="STYLESHEET" HREF="$= dir =$../../obdoc.css" 
          TITLE="ObDoc Stylesheet"/> 
    <TITLE>$( if (prefix.size()) sout << prefix << ": "; )$
           $= *title =$</TITLE>
    </HEAD>
  </xt:define>
 
  <!-- Macro define for file BODY title -->
  <xt:define name="Title_BODY" element="title">
    <xt:arg name="prefix" default=""/>
    <H1>$( if (prefix.size()) sout << prefix << ": "; )$
           $= *title =$</H1>
  </xt:define>

  <!-- Top-level project template -->
  <xt:template name="Project" element="project">
    <xt:dir>$= project["name"] =$</xt:dir>
    <xt:file>index.html</xt:file>

    <HTML>
    <xt:use template="Title_HEAD"/>     

    <BODY>
    <!-- Project title H1 -->
    <xt:use template="Title_BODY"/>     

    <!-- Project description -->
    <xt:use template="Desc"/>

    <!-- Library links -->
    <H2>Libraries</H2>
    <UL>
    <xt:template element="library" var="lib">
      <LI><A HREF='$= lib["dir"] =$/index.html'>
        <xt:template element="title">$= *title =$</xt:template>
      </A></LI>
    </xt:template>
    </UL>
    </BODY></HTML>

    <!-- Library directory -->
    <xt:template name="Library" element="library" var="lib">
      <xt:dir>$= lib["dir"] =$</xt:dir>
      <xt:file>index.html</xt:file>

      <HTML>
      <xt:use template="Title_HEAD">
        <xt:param name="dir">../</xt:param>
      </xt:use>

      <BODY>
      <!-- Library title H1 -->
      <xt:use template="Title_BODY"/>     

      <!-- Library description -->
      <xt:use template="Desc"/>

      <!-- Class links -->
      <H2>Classes</H2>
      <UL>
      <xt:template element="class" var="cls">
	<LI><A HREF='$= cls["name"] =$.html'>
	  $= cls["name"] =$: 
	  <xt:template element="title">$= *title =$</xt:template>
	</A></LI>
      </xt:template>
      </UL>
      </BODY></HTML>

      <!-- Class file -->
      <xt:template name="Class" element="class" var="cls">
	<xt:file>$= cls["name"] =$.html</xt:file>

	<HTML>
        <xt:use template="Title_HEAD">
	  <xt:param name="prefix">$= cls["name"] =$</xt:param>
          <xt:param name="dir">../</xt:param>
        </xt:use>

	<BODY>
	<!-- Class title H1 -->
        <xt:use template="Title_BODY">
	  <xt:param name="prefix">$= cls["name"] =$</xt:param>
	</xt:use>

	<!-- Class description -->
        <xt:use template="Desc"/>

	<!-- Members -->
	<H2>Class members</H2>
	<xt:template element="member">
	  <DIV CLASS="member">
	  <H3>$= member["type"] =$ $= member["name"] =$:
            <xt:template element="title">$= *title =$</xt:template></H3>
	    <xt:use template="Desc"/>
          </DIV>
	</xt:template>
 	
	<!-- Function -->
	<H2>Functions</H2>
	<xt:template element="function">
	  <DIV CLASS="function">
	  <H3><xt:template element="result">$= htmlise(result["type"]) 
                 =$</xt:template>
            $= function["name"] =$(
            <xt:template element="arg">$= (arg_index?",":"") =$ 
              $= htmlise(arg["type"]) =$ 
              $= arg["name"] =$</xt:template>):
          <xt:template element="title">$= *title =$</xt:template></H3>
          <xt:use template="Desc"/>
          </DIV>
	</xt:template>

        </BODY></HTML>
      </xt:template>
    </xt:template>
  </xt:template>
</xt:tool>  

