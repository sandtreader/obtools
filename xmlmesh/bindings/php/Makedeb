#!/bin/bash
#==========================================================================
# Build Debian package for ObTools XMLMesh PHP extension
#
# Copyright (c) 2005 Paul Clark.  All rights reserved
# This code comes with NO WARRANTY and is subject to licence agreement
#==========================================================================

set -e

DEB_VERSION=$2-$3
PACKAGE=$1_$2-$3_all.deb
SRC_DIR=`dirname $0`
DEB_DIR=/tmp/${PACKAGE}.$$
RELEASE_DIR=$SRC_DIR/../../release/
TARGARCH=all

mkdir -p $DEB_DIR/DEBIAN
mkdir -p $DEB_DIR/usr/share/php

install -m 0644 $SRC_DIR/DEBIAN/control $DEB_DIR/DEBIAN/control
install -m 0644 $SRC_DIR/ot-xmlmesh.php $DEB_DIR/usr/share/php


echo "Version: $DEB_VERSION" >> $DEB_DIR/DEBIAN/control

if [ $CENTOS ]; then
    . $ROOT/build/Makerpm
else
  #Build debs
  fakeroot -- dpkg -b $DEB_DIR $PACKAGE
  cp $PACKAGE $SRC_DIR/../../release/
fi

# clean up
rm -rf $DEB_DIR
